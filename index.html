<html>
        <head>
            <meta name="viewport" content="target-densitydpi=device-dpi, initial-scale=1.0, user-scalable=no" />  
            <style>
                body {
                    margin : 0px;
                    background-color: transparent;
                    background-repeat:no-repeat;
                    font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif; 
                    font-weight: 300; 
                    text-shadow: 0px 0px 1px #888;   

                    font-size: 0.8em; 
                    line-height: 1.2em; 
                }

                #viewport {
                    position:relative;
                }
                #viewport canvas {
                    position:absolute;
                }
				canvas {
				    /**
				     * Set transparent to let any other canvases render through
				     */
				    background-color: transparent;
				}

                #container{
                   margin: 0px;
                   max-width : 100%; 
                   height: 100%; 
                   padding: 0.8em;
                   /*background-color: #E6E6E6;*/

                   background-image: url("http://itp.nyu.edu/~jj1357/guibg.png");
                   background-size:100% 100%;
                   background-repeat:no-repeat;
                   
               }

               #log {

                   height : 30%;
                   background-color: #FFFFFF;
                   -moz-border-radius: 10px;
                   -webkit-border-radius: 10px;
                   -moz-box-shadow: inset 0 0 30px #444; 
                   -webkit-box-shadow:inset 0 0 30px #444; 
                   box-shadow:inset 0 0 30px #444; 
                   
               }
               
               #attack { 
                
                   background-color: #00ab26; 
                   position: relative;
                   
               } 
               #hide { 
                   background-color: #d90004; 
                   position: relative;         
               } 

               button { 

                   /*basic styles*/ 
                   margin-top: 5%;
                   margin-left: 90px;   
                   width: 100px; 
                   height: 100px; 
                   color: #fff; 
                   text-align: center; 
                   font-size: 1.0em; 
                   line-height: 1.2em; 
                   /*gradient styles*/ /*border styles*/ 
                   -moz-border-radius: 50px; 
                   -webkit-border-radius: 50px; 
                   border-radius: 50px; 
                   float: left;
                   /*shadow styles*/ 
                   -moz-box-shadow: 2px 3px 5px #bfbfbf; 
                   -webkit-box-shadow: 2px 3px 5px #bfbfbf; 
                   box-shadow: 2px 3px 5px #bfbfbf; 
               }  

                button:hover { 
                    -moz-box-shadow:inset 0 0 30px #444; 
                    -webkit-box-shadow:inset 0 0 30px #444; 
                    box-shadow:inset 0 0 30px #444; 
                } 
                  
                #profile {
                    margin-left : 20px;   
                    position: absolute;
                }

                img {
                    height: 20%;      
                }        

                #textbox {
                    width: 60%;
                    height: 30%;
                    max-width: 340px;
                    margin-top: 20px;
                    margin-right: 20px;
                    position: relative;
                    float: right;
                    vertical-align: middle;
                }


                </style>
                <script src="/socket.io/socket.io.js"></script>
                <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>

                <script>

                        var bottomctx;
                        var middlectx;
                        var topctx;
                        var characterctx;
                        var ballctx;
                        var grinchctx;
                        var id;
                        var WIDTH;
                        var HEIGHT;
                        var dx, dy;
                        var screenNum; 
                        
                        var icewalls = [];   

                        var snowball = "http://itp.nyu.edu/~jyp323/ju/wp-content/uploads/2013/11/snowball.png";
                        var smashed = "http://itp.nyu.edu/~jyp323/ju/wp-content/uploads/2013/11/smashedsnowball.png";

                        var grinchIsOn = false;
                        var bgisrendered;

                        //standard ==> 11520, 1080
                        var absoluteGrinchLoc = {
                                section : 1,
                                x : 3000,
                                y : 700,
                                w : 3000,
                                h : 900
                        };

                        
                        var grinchScreen1 = {
                                section: 1,
                                x : 0,
                                y : 0,
                                w : 0,
                                h : 0 
                        };
                        var grinchScreen2 = {
                                section: 2,
                                x : 0,
                                y : 0,
                                w : 0,
                                h : 0
                        };
                        var grinchScreen3 = {
                                section: 3,
                                x : 0,
                                y : 0,
                                w : 0,
                                h : 0
                        };

                        var playerList = [];

                        var characterDic1 = [{index:1, section:1, id:null, x:999, y:356, w:60, h:120, bx:1019, by:456, r:10, tx:2936, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:2, section:1, id:null, x:1126, y:306, w:60, h:120, bx:1146, by:406, r:10, tx:2670, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:3, section:1, id:null, x:1190, y:290, w:60, h:120, bx:1210, by:390, r:10, tx:2784, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:4, section:1, id:null, x:1259, y:276, w:60, h:120, bx:1279, by:376, r:10, tx:2804, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:5, section:1, id:null, x:1326, y:264, w:60, h:120, bx:1346, by:376, r:10, tx:2976, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:6, section:1, id:null, x:1394, y:237, w:60, h:120, bx:1414, by:337, r:10, tx:2925, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:7, section:1, id:null, x:1462, y:233, w:60, h:120, bx:1482, by:333, r:10, tx:2711, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:8, section:1, id:null, x:1533, y:226, w:60, h:120, bx:1553, by:326, r:10, tx:2654, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:9, section:1, id:null, x:1599, y:216, w:60, h:120, bx:1619, by:316, r:10, tx:2985, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:10, section:1, id:null, x:1662, y:209, w:60, h:120, bx:1682, by:309, r:10, tx:3062, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:11, section:1, id:null, x:1733, y:204, w:60, h:120, bx:1753, by:304, r:10, tx:2687, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:12, section:1, id:null, x:1805, y:196, w:60, h:120, bx:1825, by:296, r:10, tx:3117, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:13, section:1, id:null, x:1876, y:191, w:60, h:120, bx:1896, by:291, r:10, tx:2603, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:14, section:1, id:null, x:1950, y:188, w:60, h:120, bx:1970, by:288, r:10, tx:2698, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:15, section:1, id:null, x:2020, y:188, w:60, h:120, bx:2040, by:288, r:10, tx:3085, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:16, section:1, id:null, x:2088, y:200, w:60, h:120, bx:2108, by:300, r:10, tx:2789, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:17, section:1, id:null, x:1440, y:501, w:60, h:120, bx:1460, by:601, r:10, tx:3012, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:18, section:1, id:null, x:1503, y:468, w:60, h:120, bx:1523, by:568, r:10, tx:2661, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}];
                        var characterDic2 = [{index:1, section:2, id:null, x:43, y:199, w:60, h:120, bx:63, by:299, r:10, tx:632, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:2, section:2, id:null, x:119, y:191, w:60, h:120, bx:139, by:291, r:10, tx:463, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:3, section:2, id:null, x:198, y:186, w:60, h:120, bx:218, by:286, r:10, tx:477, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:4, section:2, id:null, x:271, y:180, w:60, h:120, bx:291, by:280, r:10, tx:619, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:5, section:2, id:null, x:345, y:170, w:60, h:120, bx:365, by:270, r:10, tx:502, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:6, section:2, id:null, x:417, y:163, w:60, h:120, bx:437, by:263, r:10, tx:411, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:7, section:2, id:null, x:487, y:157, w:60, h:120, bx:507, by:257, r:10, tx:520, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:8, section:2, id:null, x:567, y:152, w:60, h:120, bx:587, by:252, r:10, tx:515, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:9, section:2, id:null, x:638, y:145, w:60, h:120, bx:658, by:245, r:10, tx:651, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:10, section:2, id:null, x:720, y:150, w:60, h:120, bx:740, by:250, r:10, tx:525, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:11, section:2, id:null, x:795, y:145, w:60, h:120, bx:815, by:245, r:10, tx:681, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:12, section:2, id:null, x:874, y:138, w:60, h:120, bx:894, by:238, r:10, tx:489, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:13, section:2, id:null, x:953, y:121, w:60, h:120, bx:973, by:221, r:10, tx:513, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:14, section:2, id:null, x:1035, y:121, w:60, h:120, bx:1055, by:221, r:10, tx:539, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:15, section:2, id:null, x:1118, y:142, w:60, h:120, bx:1138, by:242, r:10, tx:533, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:16, section:2, id:null, x:145, y:410, w:60, h:120, bx:165, by:510, r:10, tx:642, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:17, section:2, id:null, x:220, y:389, w:60, h:120, bx:240, by:489, r:10, tx:453, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}];

                        var characterDic3 = [{index:1, section:3, id:null, x:1675, y:553, w:60, h:120, bx:1695, by:653, r:10, tx:97, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:2, section:3, id:null, x:1593, y:471, w:60, h:120, bx:1695, by:571, r:10, tx:50, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:3, section:3, id:null, x:1507, y:395, w:60, h:120, bx:1527, by:495, r:10, tx:106, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:4, section:3, id:null, x:1417, y:339, w:60, h:120, bx:1437, by:439, r:10, tx:62, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:5, section:3, id:null, x:1331, y:313, w:60, h:120, bx:1351, by:413, r:10, tx:85, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:6, section:3, id:null, x:1247, y:271, w:60, h:120, bx:1267, by:371, r:10, tx:130, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:7, section:3, id:null, x:1163, y:271, w:60, h:120, bx:1183, by:371, r:10, tx:140, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:8, section:3, id:null, x:1075, y:235, w:60, h:120, bx:1095, by:335, r:10, tx:105, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:9, section:3, id:null, x:985, y:225, w:60, h:120, bx:1005, by:325, r:10, tx:146, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:10, section:3, id:null, x:925, y:195, w:60, h:120, bx:945, by:295, r:10, tx:102, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:11, section:3, id:null, x:833, y:175, w:60, h:120, bx:853, by:275, r:10, tx:65, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:12, section:3, id:null, x:747, y:187, w:60, h:120, bx:767, by:287, r:10, tx:104, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:13, section:3, id:null, x:665, y:193, w:60, h:120, bx:685, by:293, r:10, tx:121, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:14, section:3, id:null, x:805, y:415, w:60, h:120, bx:825, by:515, r:10, tx:147, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:15, section:3, id:null, x:717, y:383, w:60, h:120, bx:737, by:483, r:10, tx:80, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:16, section:3, id:null, x:637, y:364, w:60, h:120, bx:657, by:464, r:10, tx:89, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}, {index:17, section:3, id:null, x:561, y:333, w:60, h:120, bx:581, by:433, r:10, tx:71, ty:900, attack:false, throwing:false, standingurl:"http://itp.nyu.edu/~jj1357/whosample/1-1.png", throwingurl:"http://itp.nyu.edu/~jj1357/whosample/1-2.png", hidingurl:"http://itp.nyu.edu/~jj1357/whosample/1-3.png"}];


                        //Ju's
                        //var socket = io.connect('http://ec2-54-200-42-18.us-west-2.compute.amazonaws.com:8080/');
                        //Jess's
                        var socket = io.connect('http://ec2-54-200-79-16.us-west-2.compute.amazonaws.com:8080/');
                        
                        var path = window.location.pathname;
                        var role = null;

                        socket.on('connect', function(){

                        id = socket.socket.sessionid;	

                        if(path == '/display1') {
                                role = 'display';
                                screenNum = 1;
                        } else if(path == '/display2') {
                                role = 'display';
                                screenNum = 2;
                        } else if(path == '/display3') {
                                role = 'display';
                                screenNum = 3;
                        } else if(path == '/1') {
                                role = 'user_group1';
                                guiInit(role);
                        } else if(path == '/2') {
                                role = 'user_group2';
                                guiInit(role);
                        } else if(path == '/3') {
                                role = 'user_group3';
                                guiInit(role);
                        } else if(path == '/grinch') {
                        		console.log("I'm the grinch");
                                role = 'grinch';
                                guiInit(role);
                        }       
                                
                        socket.emit('register',role);
                        
                        });
                        
                        socket.on('render', function (data){
                                // draw user on the screen! 
                                if(data.role === "display"){                                    
                                        init(); 
                                                
                                }else if( data.role === "user_group1" || data.role === "user_group2" || data.role === "user_group3"){

                                        getPlayerData(screenNum, data);

                                } else if(data.role === "grinch"){
                                        calibrateGrinchLoc();
                                        
                                }
                        });
                        

                        socket.on('renderThrow', function (data){


                                for(var i =0; i<playerList.length; i++){
                                        if(playerList[i].id == data.id && playerList[i].section == data.section){
                                                playerList[i].attack = true;

                                        }
                                }
                             
                        });

                        socket.on('setGrinchLoc', function (data){
                                //console.log(data);
                                if(data.section === 1) grinchScreen1 = data;
                                else if(data.section === 2) grinchScreen2 = data;
                                else if(data.section === 3) grinchScreen3 = data;
                                grinchIsOn = true;

                        });

                        function calibrateGrinchLoc(){
                                
                                socket.emit('calibrateLoc', absoluteGrinchLoc);        
                        }

                        var updateGrinch = function(){

                                grinchScreen1.x += 5;
                                grinchScreen2.x += 5;
                                grinchScreen3.x += 5;
                                
                        };

                        var drawGrinch = function(data){

                        	grinchctx.beginPath();
                            grinchctx.fillStyle="#00ff00";
                            grinchctx.rect(data.x, data.y, data.w, data.h); 
                            grinchctx.closePath();
                            grinchctx.fill();
      
                        };

                        function guiInit(role){
                                        
                                var container=document.createElement("div");
                                container.setAttribute('id', 'container');
                                container.setAttribute("width", "320");
                                container.setAttribute("height", "480");
                                document.body.appendChild(container); 


                                if(role === "grinch"){

                                    var log = document.createElement("div");
                                    log.setAttribute('id','log');
                                    var profile = document.createElement("div");
                                    profile.setAttribute('id', 'profile');
                                    var userimage = document.createElement("img");
                                    userimage.src = "http://www.vectorsland.com/imgd/l56756-the-grinch-logo-65964.png"
                                    var textbox = document.createElement("div");
                                    textbox.setAttribute('id','textbox');
                                    textbox.innerHTML = "You're the Grinch! Press the button and attack one section of whoville! ";
                                    
                                    profile.appendChild(userimage);
                                    log.appendChild(profile);
                                    log.appendChild(textbox);
                                    container.appendChild(log)

                                    var attack1 = document.createElement("button");
                                    attack1.setAttribute('id','attack');
                                    attack1.setAttribute('onclick', 'attackPressed(1);');
                                    attack1.innerHTML = "Attack land 1!";
                                    container.appendChild(attack1);

                                    var attack2 = document.createElement("button");
                                    attack2.setAttribute('id','attack');
                                    attack2.setAttribute('onclick', 'attackPressed(1);');
                                    attack2.innerHTML = "Attack land 2!";
                                    container.appendChild(attack2);

                                    var attack3 = document.createElement("button");
                                    attack3.setAttribute('id','attack');
                                    attack3.setAttribute('onclick', 'attackPressed(1);');
                                    attack3.innerHTML = "Attack land 3!";
                                    container.appendChild(attack3);

                                } else if(role === "user_group1"){

                                    var log = document.createElement("div");
                                    log.setAttribute('id','log');
                                    var profile = document.createElement("div");
                                    profile.setAttribute('id', 'profile');
                                    var userimage = document.createElement("img");
                                    userimage.setAttribute('id', 'playerimg');
                                    var textbox = document.createElement("div");
                                    textbox.setAttribute('id','textbox');
                                    textbox.innerHTML = "Attack Grinch with snowballs! It's better to hide when Grinch is near you. If you don't hide and then loose a hat, you'll be over! ";
                                    
                                    profile.appendChild(userimage);
                                    log.appendChild(profile);
                                    log.appendChild(textbox);
                                    container.appendChild(log)

                                    var attack = document.createElement("button");
                                    attack.setAttribute('id','attack');
                                    attack.setAttribute('onclick', 'attackPressed(1);');
                                    attack.innerHTML = "Attack!";
                                    container.appendChild(attack);

                                    var hide = document.createElement("button");
                                    hide.setAttribute('id','hide');
                                    hide.setAttribute('onclick', 'hide(1);');
                                    hide.innerHTML = "Hide!";
                                    container.appendChild(hide);
                                
                                } else if(role === "user_group2"){

                                    var log = document.createElement("div");
                                    log.setAttribute('id','log');
                                    var profile = document.createElement("div");
                                    profile.setAttribute('id', 'profile');
                                    var userimage = document.createElement("img");
                                    userimage.setAttribute('id', 'playerimg');
                                    var textbox = document.createElement("div");
                                    textbox.setAttribute('id','textbox');
                                    textbox.innerHTML = "Attack Grinch with snowballs! It's better to hide when Grinch is near you. If you don't hide and then loose a hat, you'll be over! ";
                                    
                                    profile.appendChild(userimage);
                                    log.appendChild(profile);
                                    log.appendChild(textbox);
                                    container.appendChild(log)

                                    var attack = document.createElement("button");
                                    attack.setAttribute('id','attack');
                                    attack.setAttribute('onclick', 'attackPressed(2);');
                                    attack.innerHTML = "Attack!";
                                    container.appendChild(attack);

                                    var hide = document.createElement("button");
                                    hide.setAttribute('id','hide');
                                    hide.setAttribute('onclick', 'hide(2);');
                                    hide.innerHTML = "Hide!";
                                    container.appendChild(hide);
                                
                                }  else if(role === "user_group3"){

                                    var log = document.createElement("div");
                                    log.setAttribute('id','log');
                                    var profile = document.createElement("div");
                                    profile.setAttribute('id', 'profile');
                                    var userimage = document.createElement("img");
                                    userimage.setAttribute('id', 'playerimg');
                                    var textbox = document.createElement("div");
                                    textbox.setAttribute('id','textbox');
                                    textbox.innerHTML = "Attack Grinch with snowballs! It's better to hide when Grinch is near you. If you don't hide and then loose a hat, you'll be over! ";
                                    
                                    profile.appendChild(userimage);
                                    log.appendChild(profile);
                                    log.appendChild(textbox);
                                    container.appendChild(log)

                                    var attack = document.createElement("button");
                                    attack.setAttribute('id','attack');
                                    attack.setAttribute('onclick', 'attackPressed(3);');
                                    attack.innerHTML = "Attack!";
                                    container.appendChild(attack);

                                    var hide = document.createElement("button");
                                    hide.setAttribute('id','hide');
                                    hide.setAttribute('onclick', 'hide(3);');
                                    hide.innerHTML = "Hide!";
                                    container.appendChild(hide);
                                }

                        }

                        socket.on('renderPlayerImage', function (data){

                            var userimage = document.getElementById("playerimg");
                            userimage.src = data.url;
                            var profile = document.getElementById("profile");
                            profile.appendChild(userimage);
                                    

                        });

                        function attackPressed(_section){

                                socket.emit('attack', {id: id, section: _section});
                        }
                                
                        function attack(){

                                var easing = 0.2;
                                for(var i = 0 ; i < playerList.length ; i++){

                                        if(playerList[i].attack === true){
                                                dx = playerList[i].tx - playerList[i].bx;
                                                if(Math.abs(dx)>1){
                                                        playerList[i].bx += dx * easing; 
                                                } 
                                                        
                                                dy = playerList[i].ty - playerList[i].by;
                                                if(Math.abs(dy)>1){
                                                        playerList[i].by += dy * easing; 

                                                            playerList[i].r++;

                                                } 
                                                if(Math.abs(dx)<1 || Math.abs(dy)<1){
                                                        playerList[i].bx = playerList[i].x+19;
                                                        playerList[i].by = playerList[i].y+57;
                                                        playerList[i].r = 10;
                                                        playerList[i].attack = false;
                                                }   


                                        }                                        
                               
                                }

                        }

                        function hide(){

                        }

                                
                        function init(){

                                var canvasobj;
                                var canvasgroup = [];

                                for(var i = 0; i < 5 ; i++){
                                    canvasobj = document.createElement("canvas");
                                    canvasobj.setAttribute('id', 'canvas'+i);
                                    canvasobj.width = 3840;
                                    canvasobj.height = 1080;
                                    document.getElementById('viewport').appendChild(canvasobj);
                                    canvasgroup.push(canvasobj);
                                }      
                                characterctx = document.getElementById('canvas0').getContext('2d');
                                middlectx = document.getElementById('canvas1').getContext('2d');
                                topctx = document.getElementById('canvas2').getContext('2d');
                                ballctx = document.getElementById('canvas3').getContext('2d');
                                grinchctx = document.getElementById('canvas4').getContext('2d');

                                WIDTH = 3840;
                                HEIGHT = 1080;
                                
                                renderBG_bottom();
                                createBG_middle();
                                
                                var intervalId = setInterval(draw,20);///check
                                
                                                                     
                        }

                        function renderBG_bottom(){

                            var bgurl = "url('http://itp.nyu.edu/~jj1357/grinch_bg/bottom-screen"+screenNum+".jpg')";         
                            document.body.style.backgroundImage = bgurl;
                            
                        }

                        function createBG_middle(){
                                        
                                for(var i = 1; i < 9; i++){

                                	var middleobj = new Image();
                                	var tempUrl = "http://itp.nyu.edu/~jj1357/grinch_bg_middleobj/middleobj"+i;
                                	
                                	if(i < 4) middleobj.src = tempUrl + "-screen1.png";
	                                else if(i > 5) middleobj.src = tempUrl + "-screen3.png";
	                                else middleobj.src = tempUrl + "-screen2.png";
	                 
	                                middleobj.width = 3840;
	                                middleobj.height = 1080;
	                                icewalls.push(middleobj);
                                
                                }     
                        
                        }

                        function drawBG_middle(){

                        	middlectx.clearRect(0,0,WIDTH, HEIGHT);

                        	if(screenNum === 1){
                        		middlectx.drawImage(icewalls[0],496,220);
                        		middlectx.drawImage(icewalls[1],1444,243);
                        		middlectx.drawImage(icewalls[2],2180,316);
                        		
                        	}else if(screenNum === 2){
                        		middlectx.drawImage(icewalls[3],0,173);
                        		middlectx.drawImage(icewalls[4],0,56);
                        		
                        	}else if(screenNum === 3){
                        		middlectx.drawImage(icewalls[7],532,164);
                        		middlectx.drawImage(icewalls[6],0,309);
                        		middlectx.drawImage(icewalls[5],0,240);
                        		
                        		
                        	}
                        
                        }

                        function drawBG_top(data){

                        		topctx.clearRect(0,0,WIDTH, HEIGHT);


                        	    var topLayer = new Image();
                                topLayer.src = "http://itp.nyu.edu/~jj1357/grinch_bg/top-screen"+data+".png";
                                topLayer.width = 3840;
                                topLayer.height = 1080;
                                topctx.drawImage(topLayer,0,0);
                        
                        }

                        var getPlayerData = function(screenNum, data){

                                var tempUrl = null;
                                var tempRole = null;

                                if(screenNum == 1){
                                        characterDic1[data.index-1].id = data.id;
                                        playerList.push(characterDic1[data.index-1]);
                                        tempUrl = characterDic1[data.index-1].standingurl;
                                        tempRole = data.role;

                                }else if(screenNum == 2){
                                        characterDic2[data.index-1].id = data.id;
                                        playerList.push(characterDic2[data.index-1]);
                                        tempUrl = characterDic2[data.index-1].standingurl;
                                        tempRole = data.role;

              
                                }else if (screenNum == 3){
                                        characterDic3[data.index-1].id = data.id;
                                        playerList.push(characterDic3[data.index-1]);
                                        tempUrl = characterDic3[data.index-1].standingurl;
                                        tempRole = data.role;
                                }   

                                var tempData = { id : data.id, role : tempRole, url : tempUrl};
                                socket.emit("renderPlayerImage", tempData);        
                        };

                        var drawCharacter = function(data){


                                for(var i = 0; i < playerList.length; i++){
                                        if(playerList[i].section === data){

                                        		characterctx.clearRect(playerList[i].x, playerList[i].y, playerList[i].w, playerList[i].h);

                                                if(playerList[i].attack === true || (playerList[i].by > 500 && playerList[i].by < 620 )){
                                                    playerList[i].throwing = true;
                                                } else {
                                                    playerList[i].throwing = false;
                                                }

                                                var img = new Image();
                                                if(playerList[i].throwing === true){
                                                        img.src = playerList[i].throwingurl;
                                                }else{
                                                        img.src = playerList[i].standingurl;
                                                }
                                                characterctx.drawImage(img, playerList[i].x, playerList[i].y, playerList[i].w, playerList[i].h);        
                                        }

                                }     
                                                
                        };

                        var drawBall = function(){

                        		ballctx.clearRect(0,0,WIDTH,HEIGHT);

                                var snowImage = new Image();
                                //snowImage.src = snowball;
                                for(var i =0; i<playerList.length; i++){
                                        //context.beginPath();
                                        //context.fillStyle="#ffffff";
                                        //context.arc(playerList[i].bx,playerList[i].by, playerList[i].r,0,Math.PI*2,true);
                                        

                                        if(playerList[i].by>800){
                                                snowImage.src = smashed;
                                        } else{
                                                snowImage.src = snowball;
                                        }
                                        ballctx.drawImage(snowImage, playerList[i].bx, playerList[i].by, playerList[i].r*2, playerList[i].r*2);

                                        //console.log(playerList[i].by);
                                        //context.closePath();
                                        //context.fill();
                                        
                                        
                                }
                        
                        };

                        var draw = function(){

                        		//drawBG_bottom();
                        		//drawing order ==> BG_bottom -> characters -> BG_middle-> BG_top -> Grinch -> balls
                                
                                /*if(bgisrendered == false){
                                	//console.log(bgisrendered);
                                	drawBG_middle(screenNum);
                                	//drawBG_top(screenNum);
                                }*/

                                drawCharacter(screenNum);
                                
                                drawBG_middle(screenNum);
                               	drawBG_top(screenNum);

                                grinchctx.clearRect(0,0,WIDTH,HEIGHT);
                            
                                if(grinchIsOn === true){
                                        updateGrinch();
                                        drawGrinch(grinchScreen1);
                                        drawGrinch(grinchScreen2);
                                        drawGrinch(grinchScreen3);
                                }
                                
                                attack();
                                drawBall();
                                bgisrendered = true;
                        
                        };
             
                </script>
        </head>
        <body>
             <div id="viewport"></div>   
        </body>
</html>